"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const aws_cdk_lib_1 = require("aws-cdk-lib");
const stack_composer_1 = require("../lib/stack-composer");
const assertions_1 = require("aws-cdk-lib/assertions");
const opensearch_service_domain_cdk_stack_1 = require("../lib/opensearch-service-domain-cdk-stack");
test('Test empty string provided for a parameter which has a default value, uses the default value', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            domainName: ""
        }
    });
    const openSearchStacks = new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    const domainStack = openSearchStacks.stacks.filter((s) => s instanceof opensearch_service_domain_cdk_stack_1.OpensearchServiceDomainCdkStack)[0];
    const domainTemplate = assertions_1.Template.fromStack(domainStack);
    domainTemplate.resourceCountIs("AWS::OpenSearchService::Domain", 1);
});
test('Test invalid engine version format throws error', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            // Should be OS_1.3
            engineVersion: "OpenSearch_1.3"
        }
    });
    const createStackFunc = () => new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    expect(createStackFunc).toThrowError();
});
test('Test ES 7.10 engine version format is parsed', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            engineVersion: "ES_7.10"
        }
    });
    const openSearchStacks = new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    const domainStack = openSearchStacks.stacks.filter((s) => s instanceof opensearch_service_domain_cdk_stack_1.OpensearchServiceDomainCdkStack)[0];
    const domainTemplate = assertions_1.Template.fromStack(domainStack);
    domainTemplate.resourceCountIs("AWS::OpenSearchService::Domain", 1);
});
test('Test OS 1.3 engine version format is parsed', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            engineVersion: "OS_1.3"
        }
    });
    const openSearchStacks = new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    const domainStack = openSearchStacks.stacks.filter((s) => s instanceof opensearch_service_domain_cdk_stack_1.OpensearchServiceDomainCdkStack)[0];
    const domainTemplate = assertions_1.Template.fromStack(domainStack);
    domainTemplate.resourceCountIs("AWS::OpenSearchService::Domain", 1);
});
test('Test access policy is parsed for proper array format', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            accessPolicies: {
                "Version": "2012-10-17",
                "Statement": [
                    {
                        "Effect": "Allow",
                        "Principal": { "AWS": "arn:aws:iam::123456789123:user/test-user" },
                        "Action": "es:ESHttp*",
                        "Resource": "arn:aws:es:us-east-1:123456789123:domain/test-os-domain/*"
                    },
                    {
                        "Effect": "Allow",
                        "Principal": { "AWS": "arn:aws:iam::123456789123:user/test-user2" },
                        "Action": "es:ESHttp*",
                        "Resource": "arn:aws:es:us-east-1:123456789123:domain/test-os-domain/*"
                    }
                ]
            }
        }
    });
    const openSearchStacks = new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    const domainStack = openSearchStacks.stacks.filter((s) => s instanceof opensearch_service_domain_cdk_stack_1.OpensearchServiceDomainCdkStack)[0];
    const domainTemplate = assertions_1.Template.fromStack(domainStack);
    // Check that accessPolicies policy is created
    domainTemplate.resourceCountIs("Custom::OpenSearchAccessPolicy", 1);
});
test('Test access policy is parsed for proper block format', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            accessPolicies: {
                "Version": "2012-10-17",
                "Statement": {
                    "Effect": "Allow",
                    "Principal": { "AWS": "*" },
                    "Action": "es:ESHttp*",
                    "Resource": "arn:aws:es:us-east-1:123456789123:domain/test-os-domain/*"
                }
            }
        }
    });
    const openSearchStacks = new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    const domainStack = openSearchStacks.stacks.filter((s) => s instanceof opensearch_service_domain_cdk_stack_1.OpensearchServiceDomainCdkStack)[0];
    const domainTemplate = assertions_1.Template.fromStack(domainStack);
    // Check that accessPolicies policy is created
    domainTemplate.resourceCountIs("Custom::OpenSearchAccessPolicy", 1);
});
test('Test access policy missing Statement throws error', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            accessPolicies: { "Version": "2012-10-17" }
        }
    });
    const createStackFunc = () => new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    expect(createStackFunc).toThrowError();
});
test('Test access policy with empty Statement array throws error', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            accessPolicies: { "Version": "2012-10-17", "Statement": [] }
        }
    });
    const createStackFunc = () => new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    expect(createStackFunc).toThrowError();
});
test('Test access policy with empty Statement block throws error', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            accessPolicies: { "Version": "2012-10-17", "Statement": {} }
        }
    });
    const createStackFunc = () => new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    expect(createStackFunc).toThrowError();
});
test('Test access policy with improper Statement throws error', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            // Missing required fields in Statement
            accessPolicies: { "Version": "2012-10-17", "Statement": [{ "Effect": "Allow" }] }
        }
    });
    const createStackFunc = () => new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    expect(createStackFunc).toThrowError();
});
test('Test invalid TLS security policy throws error', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            tlsSecurityPolicy: "TLS_0_9"
        }
    });
    const createStackFunc = () => new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    expect(createStackFunc).toThrowError();
});
test('Test invalid EBS volume type throws error', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            ebsVolumeType: "GP0",
        }
    });
    const createStackFunc = () => new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    expect(createStackFunc).toThrowError();
});
test('Test invalid domain removal policy type throws error', () => {
    const app = new aws_cdk_lib_1.App({
        context: {
            domainRemovalPolicy: "DELETE",
        }
    });
    const createStackFunc = () => new stack_composer_1.StackComposer(app, {
        env: { account: "test-account", region: "us-east-1" }, stage: "unittest"
    });
    expect(createStackFunc).toThrowError();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhY2stY29tcG9zZXIudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInN0YWNrLWNvbXBvc2VyLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBZ0M7QUFDaEMsMERBQW9EO0FBQ3BELHVEQUFnRDtBQUNoRCxvR0FBMkY7QUFFM0YsSUFBSSxDQUFDLDhGQUE4RixFQUFFLEdBQUcsRUFBRTtJQUV0RyxNQUFNLEdBQUcsR0FBRyxJQUFJLGlCQUFHLENBQUM7UUFDaEIsT0FBTyxFQUFFO1lBQ0wsVUFBVSxFQUFFLEVBQUU7U0FDakI7S0FDSixDQUFDLENBQUE7SUFFRixNQUFNLGdCQUFnQixHQUFJLElBQUksOEJBQWEsQ0FBQyxHQUFHLEVBQUU7UUFDN0MsR0FBRyxFQUFFLEVBQUMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFDLEVBQUUsS0FBSyxFQUFFLFVBQVU7S0FDekUsQ0FBQyxDQUFBO0lBRUYsTUFBTSxXQUFXLEdBQUcsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxZQUFZLHFFQUErQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDMUcsTUFBTSxjQUFjLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUE7SUFDdEQsY0FBYyxDQUFDLGVBQWUsQ0FBQyxnQ0FBZ0MsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUN2RSxDQUFDLENBQUMsQ0FBQTtBQUVGLElBQUksQ0FBQyxpREFBaUQsRUFBRSxHQUFHLEVBQUU7SUFFekQsTUFBTSxHQUFHLEdBQUcsSUFBSSxpQkFBRyxDQUFDO1FBQ2hCLE9BQU8sRUFBRTtZQUNMLG1CQUFtQjtZQUNuQixhQUFhLEVBQUUsZ0JBQWdCO1NBQ2xDO0tBQ0osQ0FBQyxDQUFBO0lBRUYsTUFBTSxlQUFlLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSw4QkFBYSxDQUFDLEdB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QyxDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7QXBwfSBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCB7U3RhY2tDb21wb3Nlcn0gZnJvbSBcIi4uL2xpYi9zdGFjay1jb21wb3NlclwiO1xuaW1wb3J0IHtUZW1wbGF0ZX0gZnJvbSBcImF3cy1jZGstbGliL2Fzc2VydGlvbnNcIjtcbmltcG9ydCB7T3BlbnNlYXJjaFNlcnZpY2VEb21haW5DZGtTdGFja30gZnJvbSBcIi4uL2xpYi9vcGVuc2VhcmNoLXNlcnZpY2UtZG9tYWluLWNkay1zdGFja1wiO1xuXG50ZXN0KCdUZXN0IGVtcHR5IHN0cmluZyBwcm92aWRlZCBmb3IgYSBwYXJhbWV0ZXIgd2hpY2ggaGFzIGEgZGVmYXVsdCB2YWx1ZSwgdXNlcyB0aGUgZGVmYXVsdCB2YWx1ZScsICgpID0+IHtcblxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBkb21haW5OYW1lOiBcIlwiXG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3Qgb3BlblNlYXJjaFN0YWNrcyA9ICBuZXcgU3RhY2tDb21wb3NlcihhcHAsIHtcbiAgICAgICAgZW52OiB7YWNjb3VudDogXCJ0ZXN0LWFjY291bnRcIiwgcmVnaW9uOiBcInVzLWVhc3QtMVwifSwgc3RhZ2U6IFwidW5pdHRlc3RcIlxuICAgIH0pXG5cbiAgICBjb25zdCBkb21haW5TdGFjayA9IG9wZW5TZWFyY2hTdGFja3Muc3RhY2tzLmZpbHRlcigocykgPT4gcyBpbnN0YW5jZW9mIE9wZW5zZWFyY2hTZXJ2aWNlRG9tYWluQ2RrU3RhY2spWzBdXG4gICAgY29uc3QgZG9tYWluVGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soZG9tYWluU3RhY2spXG4gICAgZG9tYWluVGVtcGxhdGUucmVzb3VyY2VDb3VudElzKFwiQVdTOjpPcGVuU2VhcmNoU2VydmljZTo6RG9tYWluXCIsIDEpXG59KVxuXG50ZXN0KCdUZXN0IGludmFsaWQgZW5naW5lIHZlcnNpb24gZm9ybWF0IHRocm93cyBlcnJvcicsICgpID0+IHtcblxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAvLyBTaG91bGQgYmUgT1NfMS4zXG4gICAgICAgICAgICBlbmdpbmVWZXJzaW9uOiBcIk9wZW5TZWFyY2hfMS4zXCJcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBjcmVhdGVTdGFja0Z1bmMgPSAoKSA9PiBuZXcgU3RhY2tDb21wb3NlcihhcHAsIHtcbiAgICAgICAgZW52OiB7YWNjb3VudDogXCJ0ZXN0LWFjY291bnRcIiwgcmVnaW9uOiBcInVzLWVhc3QtMVwifSwgc3RhZ2U6IFwidW5pdHRlc3RcIlxuICAgIH0pXG5cbiAgICBleHBlY3QoY3JlYXRlU3RhY2tGdW5jKS50b1Rocm93RXJyb3IoKVxufSlcblxudGVzdCgnVGVzdCBFUyA3LjEwIGVuZ2luZSB2ZXJzaW9uIGZvcm1hdCBpcyBwYXJzZWQnLCAoKSA9PiB7XG5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgZW5naW5lVmVyc2lvbjogXCJFU183LjEwXCJcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBvcGVuU2VhcmNoU3RhY2tzID0gIG5ldyBTdGFja0NvbXBvc2VyKGFwcCwge1xuICAgICAgICBlbnY6IHthY2NvdW50OiBcInRlc3QtYWNjb3VudFwiLCByZWdpb246IFwidXMtZWFzdC0xXCJ9LCBzdGFnZTogXCJ1bml0dGVzdFwiXG4gICAgfSlcblxuICAgIGNvbnN0IGRvbWFpblN0YWNrID0gb3BlblNlYXJjaFN0YWNrcy5zdGFja3MuZmlsdGVyKChzKSA9PiBzIGluc3RhbmNlb2YgT3BlbnNlYXJjaFNlcnZpY2VEb21haW5DZGtTdGFjaylbMF1cbiAgICBjb25zdCBkb21haW5UZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhkb21haW5TdGFjaylcbiAgICBkb21haW5UZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoXCJBV1M6Ok9wZW5TZWFyY2hTZXJ2aWNlOjpEb21haW5cIiwgMSlcbn0pXG5cbnRlc3QoJ1Rlc3QgT1MgMS4zIGVuZ2luZSB2ZXJzaW9uIGZvcm1hdCBpcyBwYXJzZWQnLCAoKSA9PiB7XG5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgZW5naW5lVmVyc2lvbjogXCJPU18xLjNcIlxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IG9wZW5TZWFyY2hTdGFja3MgPSAgbmV3IFN0YWNrQ29tcG9zZXIoYXBwLCB7XG4gICAgICAgIGVudjoge2FjY291bnQ6IFwidGVzdC1hY2NvdW50XCIsIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIn0sIHN0YWdlOiBcInVuaXR0ZXN0XCJcbiAgICB9KVxuXG4gICAgY29uc3QgZG9tYWluU3RhY2sgPSBvcGVuU2VhcmNoU3RhY2tzLnN0YWNrcy5maWx0ZXIoKHMpID0+IHMgaW5zdGFuY2VvZiBPcGVuc2VhcmNoU2VydmljZURvbWFpbkNka1N0YWNrKVswXVxuICAgIGNvbnN0IGRvbWFpblRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKGRvbWFpblN0YWNrKVxuICAgIGRvbWFpblRlbXBsYXRlLnJlc291cmNlQ291bnRJcyhcIkFXUzo6T3BlblNlYXJjaFNlcnZpY2U6OkRvbWFpblwiLCAxKVxufSlcblxudGVzdCgnVGVzdCBhY2Nlc3MgcG9saWN5IGlzIHBhcnNlZCBmb3IgcHJvcGVyIGFycmF5IGZvcm1hdCcsICgpID0+IHtcblxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBhY2Nlc3NQb2xpY2llczpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIFwiVmVyc2lvblwiOiBcIjIwMTItMTAtMTdcIixcbiAgICAgICAgICAgICAgICAgICAgXCJTdGF0ZW1lbnRcIjogW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJFZmZlY3RcIjogXCJBbGxvd1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJQcmluY2lwYWxcIjoge1wiQVdTXCI6IFwiYXJuOmF3czppYW06OjEyMzQ1Njc4OTEyMzp1c2VyL3Rlc3QtdXNlclwifSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiQWN0aW9uXCI6IFwiZXM6RVNIdHRwKlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJSZXNvdXJjZVwiOiBcImFybjphd3M6ZXM6dXMtZWFzdC0xOjEyMzQ1Njc4OTEyMzpkb21haW4vdGVzdC1vcy1kb21haW4vKlwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiRWZmZWN0XCI6IFwiQWxsb3dcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlByaW5jaXBhbFwiOiB7XCJBV1NcIjogXCJhcm46YXdzOmlhbTo6MTIzNDU2Nzg5MTIzOnVzZXIvdGVzdC11c2VyMlwifSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkFjdGlvblwiOiBcImVzOkVTSHR0cCpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlJlc291cmNlXCI6IFwiYXJuOmF3czplczp1cy1lYXN0LTE6MTIzNDU2Nzg5MTIzOmRvbWFpbi90ZXN0LW9zLWRvbWFpbi8qXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IG9wZW5TZWFyY2hTdGFja3MgPSAgbmV3IFN0YWNrQ29tcG9zZXIoYXBwLCB7XG4gICAgICAgIGVudjoge2FjY291bnQ6IFwidGVzdC1hY2NvdW50XCIsIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIn0sIHN0YWdlOiBcInVuaXR0ZXN0XCJcbiAgICB9KVxuXG4gICAgY29uc3QgZG9tYWluU3RhY2sgPSBvcGVuU2VhcmNoU3RhY2tzLnN0YWNrcy5maWx0ZXIoKHMpID0+IHMgaW5zdGFuY2VvZiBPcGVuc2VhcmNoU2VydmljZURvbWFpbkNka1N0YWNrKVswXVxuICAgIGNvbnN0IGRvbWFpblRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKGRvbWFpblN0YWNrKVxuICAgIC8vIENoZWNrIHRoYXQgYWNjZXNzUG9saWNpZXMgcG9saWN5IGlzIGNyZWF0ZWRcbiAgICBkb21haW5UZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoXCJDdXN0b206Ok9wZW5TZWFyY2hBY2Nlc3NQb2xpY3lcIiwgMSlcbn0pXG5cbnRlc3QoJ1Rlc3QgYWNjZXNzIHBvbGljeSBpcyBwYXJzZWQgZm9yIHByb3BlciBibG9jayBmb3JtYXQnLCAoKSA9PiB7XG5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgYWNjZXNzUG9saWNpZXM6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBcIlZlcnNpb25cIjogXCIyMDEyLTEwLTE3XCIsXG4gICAgICAgICAgICAgICAgICAgIFwiU3RhdGVtZW50XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiRWZmZWN0XCI6IFwiQWxsb3dcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiUHJpbmNpcGFsXCI6IHtcIkFXU1wiOiBcIipcIn0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkFjdGlvblwiOiBcImVzOkVTSHR0cCpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiUmVzb3VyY2VcIjogXCJhcm46YXdzOmVzOnVzLWVhc3QtMToxMjM0NTY3ODkxMjM6ZG9tYWluL3Rlc3Qtb3MtZG9tYWluLypcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IG9wZW5TZWFyY2hTdGFja3MgPSAgbmV3IFN0YWNrQ29tcG9zZXIoYXBwLCB7XG4gICAgICAgIGVudjoge2FjY291bnQ6IFwidGVzdC1hY2NvdW50XCIsIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIn0sIHN0YWdlOiBcInVuaXR0ZXN0XCJcbiAgICB9KVxuXG4gICAgY29uc3QgZG9tYWluU3RhY2sgPSBvcGVuU2VhcmNoU3RhY2tzLnN0YWNrcy5maWx0ZXIoKHMpID0+IHMgaW5zdGFuY2VvZiBPcGVuc2VhcmNoU2VydmljZURvbWFpbkNka1N0YWNrKVswXVxuICAgIGNvbnN0IGRvbWFpblRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKGRvbWFpblN0YWNrKVxuICAgIC8vIENoZWNrIHRoYXQgYWNjZXNzUG9saWNpZXMgcG9saWN5IGlzIGNyZWF0ZWRcbiAgICBkb21haW5UZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoXCJDdXN0b206Ok9wZW5TZWFyY2hBY2Nlc3NQb2xpY3lcIiwgMSlcbn0pXG5cbnRlc3QoJ1Rlc3QgYWNjZXNzIHBvbGljeSBtaXNzaW5nIFN0YXRlbWVudCB0aHJvd3MgZXJyb3InLCAoKSA9PiB7XG5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgYWNjZXNzUG9saWNpZXM6IHtcIlZlcnNpb25cIjpcIjIwMTItMTAtMTdcIn1cbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBjcmVhdGVTdGFja0Z1bmMgPSAoKSA9PiBuZXcgU3RhY2tDb21wb3NlcihhcHAsIHtcbiAgICAgICAgZW52OiB7YWNjb3VudDogXCJ0ZXN0LWFjY291bnRcIiwgcmVnaW9uOiBcInVzLWVhc3QtMVwifSwgc3RhZ2U6IFwidW5pdHRlc3RcIlxuICAgIH0pXG5cbiAgICBleHBlY3QoY3JlYXRlU3RhY2tGdW5jKS50b1Rocm93RXJyb3IoKVxufSlcblxudGVzdCgnVGVzdCBhY2Nlc3MgcG9saWN5IHdpdGggZW1wdHkgU3RhdGVtZW50IGFycmF5IHRocm93cyBlcnJvcicsICgpID0+IHtcblxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBhY2Nlc3NQb2xpY2llczoge1wiVmVyc2lvblwiOlwiMjAxMi0xMC0xN1wiLCBcIlN0YXRlbWVudFwiOltdfVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IGNyZWF0ZVN0YWNrRnVuYyA9ICgpID0+IG5ldyBTdGFja0NvbXBvc2VyKGFwcCwge1xuICAgICAgICBlbnY6IHthY2NvdW50OiBcInRlc3QtYWNjb3VudFwiLCByZWdpb246IFwidXMtZWFzdC0xXCJ9LCBzdGFnZTogXCJ1bml0dGVzdFwiXG4gICAgfSlcblxuICAgIGV4cGVjdChjcmVhdGVTdGFja0Z1bmMpLnRvVGhyb3dFcnJvcigpXG59KVxuXG50ZXN0KCdUZXN0IGFjY2VzcyBwb2xpY3kgd2l0aCBlbXB0eSBTdGF0ZW1lbnQgYmxvY2sgdGhyb3dzIGVycm9yJywgKCkgPT4ge1xuXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCh7XG4gICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgIGFjY2Vzc1BvbGljaWVzOiB7XCJWZXJzaW9uXCI6XCIyMDEyLTEwLTE3XCIsIFwiU3RhdGVtZW50XCI6e319XG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3QgY3JlYXRlU3RhY2tGdW5jID0gKCkgPT4gbmV3IFN0YWNrQ29tcG9zZXIoYXBwLCB7XG4gICAgICAgIGVudjoge2FjY291bnQ6IFwidGVzdC1hY2NvdW50XCIsIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIn0sIHN0YWdlOiBcInVuaXR0ZXN0XCJcbiAgICB9KVxuXG4gICAgZXhwZWN0KGNyZWF0ZVN0YWNrRnVuYykudG9UaHJvd0Vycm9yKClcbn0pXG5cbnRlc3QoJ1Rlc3QgYWNjZXNzIHBvbGljeSB3aXRoIGltcHJvcGVyIFN0YXRlbWVudCB0aHJvd3MgZXJyb3InLCAoKSA9PiB7XG5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgLy8gTWlzc2luZyByZXF1aXJlZCBmaWVsZHMgaW4gU3RhdGVtZW50XG4gICAgICAgICAgICBhY2Nlc3NQb2xpY2llczoge1wiVmVyc2lvblwiOlwiMjAxMi0xMC0xN1wiLCBcIlN0YXRlbWVudFwiOlt7XCJFZmZlY3RcIjogXCJBbGxvd1wifV19XG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3QgY3JlYXRlU3RhY2tGdW5jID0gKCkgPT4gbmV3IFN0YWNrQ29tcG9zZXIoYXBwLCB7XG4gICAgICAgIGVudjoge2FjY291bnQ6IFwidGVzdC1hY2NvdW50XCIsIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIn0sIHN0YWdlOiBcInVuaXR0ZXN0XCJcbiAgICB9KVxuXG4gICAgZXhwZWN0KGNyZWF0ZVN0YWNrRnVuYykudG9UaHJvd0Vycm9yKClcbn0pXG5cbnRlc3QoJ1Rlc3QgaW52YWxpZCBUTFMgc2VjdXJpdHkgcG9saWN5IHRocm93cyBlcnJvcicsICgpID0+IHtcblxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICB0bHNTZWN1cml0eVBvbGljeTogXCJUTFNfMF85XCJcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBjcmVhdGVTdGFja0Z1bmMgPSAoKSA9PiBuZXcgU3RhY2tDb21wb3NlcihhcHAsIHtcbiAgICAgICAgZW52OiB7YWNjb3VudDogXCJ0ZXN0LWFjY291bnRcIiwgcmVnaW9uOiBcInVzLWVhc3QtMVwifSwgc3RhZ2U6IFwidW5pdHRlc3RcIlxuICAgIH0pXG5cbiAgICBleHBlY3QoY3JlYXRlU3RhY2tGdW5jKS50b1Rocm93RXJyb3IoKVxufSlcblxudGVzdCgnVGVzdCBpbnZhbGlkIEVCUyB2b2x1bWUgdHlwZSB0aHJvd3MgZXJyb3InLCAoKSA9PiB7XG5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgZWJzVm9sdW1lVHlwZTogXCJHUDBcIixcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBjcmVhdGVTdGFja0Z1bmMgPSAoKSA9PiBuZXcgU3RhY2tDb21wb3NlcihhcHAsIHtcbiAgICAgICAgZW52OiB7YWNjb3VudDogXCJ0ZXN0LWFjY291bnRcIiwgcmVnaW9uOiBcInVzLWVhc3QtMVwifSwgc3RhZ2U6IFwidW5pdHRlc3RcIlxuICAgIH0pXG5cbiAgICBleHBlY3QoY3JlYXRlU3RhY2tGdW5jKS50b1Rocm93RXJyb3IoKVxufSlcblxudGVzdCgnVGVzdCBpbnZhbGlkIGRvbWFpbiByZW1vdmFsIHBvbGljeSB0eXBlIHRocm93cyBlcnJvcicsICgpID0+IHtcblxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBkb21haW5SZW1vdmFsUG9saWN5OiBcIkRFTEVURVwiLFxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IGNyZWF0ZVN0YWNrRnVuYyA9ICgpID0+IG5ldyBTdGFja0NvbXBvc2VyKGFwcCwge1xuICAgICAgICBlbnY6IHthY2NvdW50OiBcInRlc3QtYWNjb3VudFwiLCByZWdpb246IFwidXMtZWFzdC0xXCJ9LCBzdGFnZTogXCJ1bml0dGVzdFwiXG4gICAgfSlcblxuICAgIGV4cGVjdChjcmVhdGVTdGFja0Z1bmMpLnRvVGhyb3dFcnJvcigpXG59KSJdfQ==