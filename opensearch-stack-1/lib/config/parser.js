"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigParser = void 0;
const validator_1 = require("./validator");
class ConfigParser {
    static parse(scope, stage, defaults) {
        const validator = new validator_1.ConfigValidator();
        const domainName = this.getContextForType(scope, 'domainName', 'string', defaults);
        const engineVersion = this.getContextForType(scope, 'engineVersion', 'string', defaults);
        const dataNodeType = this.getContextForType(scope, 'dataNodeType', 'string', defaults);
        const dataNodeCount = this.getContextForType(scope, 'dataNodeCount', 'number', defaults);
        const dedicatedManagerNodeType = this.getContextForType(scope, 'dedicatedManagerNodeType', 'string', defaults);
        const dedicatedManagerNodeCount = this.getContextForType(scope, 'dedicatedManagerNodeCount', 'number', defaults);
        const warmNodeType = this.getContextForType(scope, 'warmNodeType', 'string', defaults);
        const warmNodeCount = this.getContextForType(scope, 'warmNodeCount', 'number', defaults);
        const ebsEnabled = this.getContextForType(scope, 'ebsEnabled', 'boolean', defaults);
        const ebsIops = this.getContextForType(scope, 'ebsIops', 'number', defaults);
        const ebsVolumeSize = this.getContextForType(scope, 'ebsVolumeSize', 'number', defaults);
        const ebsVolumeType = this.getContextForType(scope, 'ebsVolumeType', 'string', defaults);
        const vpcEnabled = this.getContextForType(scope, 'vpcEnabled', 'boolean', defaults);
        const vpcId = this.getContextForType(scope, 'vpcId', 'string', defaults);
        const vpcSubnetIds = this.getContextForType(scope, 'vpcSubnetIds', 'object', defaults);
        const vpcSecurityGroupIds = this.getContextForType(scope, 'vpcSecurityGroupIds', 'object', defaults);
        const availabilityZoneCount = this.getContextForType(scope, 'availabilityZoneCount', 'number', defaults);
        const eksLogGroupName = this.getContextForType(scope, 'eksLogGroupName', 'string', defaults);
        const podLogGroupName = this.getContextForType(scope, 'podLogGroupName', 'string', defaults);
        const appTypeConfigs = this.getContextForType(scope, 'appTypeConfigs', 'object', defaults);
        validator.validateRequired(domainName, 'domainName');
        validator.validateEngineVersion(engineVersion);
        validator.validateEbsVolumeType(ebsVolumeType);
        return {
            openSearch: {
                domainName: domainName,
                engineVersion: engineVersion,
                dataNodeType: dataNodeType || 't3.small.search',
                dataNodeCount: dataNodeCount || 1,
                dedicatedManagerNodeType,
                dedicatedManagerNodeCount,
                warmNodeType,
                warmNodeCount,
                ebsEnabled: ebsEnabled !== undefined ? ebsEnabled : true,
                ebsIops,
                ebsVolumeSize: ebsVolumeSize || 10,
                ebsVolumeType,
                availabilityZoneCount: availabilityZoneCount || 1,
            },
            network: {
                vpcEnabled: vpcEnabled || false,
                vpcId,
                vpcSubnetIds,
                vpcSecurityGroupIds,
                availabilityZoneCount: availabilityZoneCount || 1,
            },
            logs: {
                eksLogGroupName,
                podLogGroupName,
                appTypeConfigs: appTypeConfigs || [],
            },
            stage,
        };
    }
    static getContextForType(scope, optionName, expectedType, defaultValues) {
        const option = scope.node.tryGetContext(optionName);
        // If no context is provided (undefined or empty string) and a default value exists, use it
        if ((option === undefined || option === "") && defaultValues[optionName]) {
            return defaultValues[optionName];
        }
        // Filter out invalid or missing options by setting undefined (empty strings, null, undefined, NaN)
        if (option !== false && option !== 0 && !option) {
            return undefined;
        }
        // Values provided by the CLI will always be represented as a string and need to be parsed
        if (typeof option === 'string') {
            if (expectedType === 'number') {
                const parsed = parseInt(option);
                if (isNaN(parsed)) {
                    throw new Error(`Invalid number format for ${optionName}: ${option}`);
                }
                return parsed;
            }
            if (expectedType === 'boolean' || expectedType === 'object') {
                try {
                    return JSON.parse(option);
                }
                catch (error) {
                    throw new Error(`Invalid JSON format for ${optionName}: ${option}`);
                }
            }
        }
        // Values provided by the cdk.context.json should be of the desired type
        if (typeof option !== expectedType) {
            throw new Error(`Type provided by cdk.context.json for ${optionName} was ${typeof option} but expected ${expectedType}`);
        }
        return option;
    }
}
exports.ConfigParser = ConfigParser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLDJDQUE4QztBQUU5QyxNQUFhLFlBQVk7SUFFckIsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFnQixFQUFFLEtBQWEsRUFBRSxRQUEyQjtRQUNyRSxNQUFNLFNBQVMsR0FBRyxJQUFJLDJCQUFlLEVBQUUsQ0FBQztRQUV4QyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDbkYsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3pGLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN2RixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDekYsTUFBTSx3QkFBd0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLDBCQUEwQixFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUMvRyxNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsMkJBQTJCLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ2pILE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN2RixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLGVB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QixVQUFVLEtBQUssTUFBTSxFQUFFLENBQUMsQ0FBQztnQkFDeEUsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDO1FBRUQsd0VBQXdFO1FBQ3hFLElBQUksT0FBTyxNQUFNLEtBQUssWUFBWSxFQUFFLENBQUM7WUFDakMsTUFBTSxJQUFJLEtBQUssQ0FBQyx5Q0FBeUMsVUFBVSxRQUFRLE9BQU8sTUFBTSxpQkFBaUIsWUFBWSxFQUFFLENBQUMsQ0FBQztRQUM3SCxDQUFDO1FBRUQsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQztDQUNKO0FBekdELG9DQXlHQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgeyBSYXdDb25maWdEZWZhdWx0cywgU3RhY2tDb25maWd1cmF0aW9uIH0gZnJvbSBcIi4vdHlwZXNcIjtcbmltcG9ydCB7IENvbmZpZ1ZhbGlkYXRvciB9IGZyb20gXCIuL3ZhbGlkYXRvclwiO1xuXG5leHBvcnQgY2xhc3MgQ29uZmlnUGFyc2VyIHtcbiAgICBcbiAgICBzdGF0aWMgcGFyc2Uoc2NvcGU6IENvbnN0cnVjdCwgc3RhZ2U6IHN0cmluZywgZGVmYXVsdHM6IFJhd0NvbmZpZ0RlZmF1bHRzKTogU3RhY2tDb25maWd1cmF0aW9uIHtcbiAgICAgICAgY29uc3QgdmFsaWRhdG9yID0gbmV3IENvbmZpZ1ZhbGlkYXRvcigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZG9tYWluTmFtZSA9IHRoaXMuZ2V0Q29udGV4dEZvclR5cGUoc2NvcGUsICdkb21haW5OYW1lJywgJ3N0cmluZycsIGRlZmF1bHRzKTtcbiAgICAgICAgY29uc3QgZW5naW5lVmVyc2lvbiA9IHRoaXMuZ2V0Q29udGV4dEZvclR5cGUoc2NvcGUsICdlbmdpbmVWZXJzaW9uJywgJ3N0cmluZycsIGRlZmF1bHRzKTtcbiAgICAgICAgY29uc3QgZGF0YU5vZGVUeXBlID0gdGhpcy5nZXRDb250ZXh0Rm9yVHlwZShzY29wZSwgJ2RhdGFOb2RlVHlwZScsICdzdHJpbmcnLCBkZWZhdWx0cyk7XG4gICAgICAgIGNvbnN0IGRhdGFOb2RlQ291bnQgPSB0aGlzLmdldENvbnRleHRGb3JUeXBlKHNjb3BlLCAnZGF0YU5vZGVDb3VudCcsICdudW1iZXInLCBkZWZhdWx0cyk7XG4gICAgICAgIGNvbnN0IGRlZGljYXRlZE1hbmFnZXJOb2RlVHlwZSA9IHRoaXMuZ2V0Q29udGV4dEZvclR5cGUoc2NvcGUsICdkZWRpY2F0ZWRNYW5hZ2VyTm9kZVR5cGUnLCAnc3RyaW5nJywgZGVmYXVsdHMpO1xuICAgICAgICBjb25zdCBkZWRpY2F0ZWRNYW5hZ2VyTm9kZUNvdW50ID0gdGhpcy5nZXRDb250ZXh0Rm9yVHlwZShzY29wZSwgJ2RlZGljYXRlZE1hbmFnZXJOb2RlQ291bnQnLCAnbnVtYmVyJywgZGVmYXVsdHMpO1xuICAgICAgICBjb25zdCB3YXJtTm9kZVR5cGUgPSB0aGlzLmdldENvbnRleHRGb3JUeXBlKHNjb3BlLCAnd2FybU5vZGVUeXBlJywgJ3N0cmluZycsIGRlZmF1bHRzKTtcbiAgICAgICAgY29uc3Qgd2FybU5vZGVDb3VudCA9IHRoaXMuZ2V0Q29udGV4dEZvclR5cGUoc2NvcGUsICd3YXJtTm9kZUNvdW50JywgJ251bWJlcicsIGRlZmF1bHRzKTtcbiAgICAgICAgY29uc3QgZWJzRW5hYmxlZCA9IHRoaXMuZ2V0Q29udGV4dEZvclR5cGUoc2NvcGUsICdlYnNFbmFibGVkJywgJ2Jvb2xlYW4nLCBkZWZhdWx0cyk7XG4gICAgICAgIGNvbnN0IGVic0lvcHMgPSB0aGlzLmdldENvbnRleHRGb3JUeXBlKHNjb3BlLCAnZWJzSW9wcycsICdudW1iZXInLCBkZWZhdWx0cyk7XG4gICAgICAgIGNvbnN0IGVic1ZvbHVtZVNpemUgPSB0aGlzLmdldENvbnRleHRGb3JUeXBlKHNjb3BlLCAnZWJzVm9sdW1lU2l6ZScsICdudW1iZXInLCBkZWZhdWx0cyk7XG4gICAgICAgIGNvbnN0IGVic1ZvbHVtZVR5cGUgPSB0aGlzLmdldENvbnRleHRGb3JUeXBlKHNjb3BlLCAnZWJzVm9sdW1lVHlwZScsICdzdHJpbmcnLCBkZWZhdWx0cyk7XG4gICAgICAgIGNvbnN0IHZwY0VuYWJsZWQgPSB0aGlzLmdldENvbnRleHRGb3JUeXBlKHNjb3BlLCAndnBjRW5hYmxlZCcsICdib29sZWFuJywgZGVmYXVsdHMpO1xuICAgICAgICBjb25zdCB2cGNJZCA9IHRoaXMuZ2V0Q29udGV4dEZvclR5cGUoc2NvcGUsICd2cGNJZCcsICdzdHJpbmcnLCBkZWZhdWx0cyk7XG4gICAgICAgIGNvbnN0IHZwY1N1Ym5ldElkcyA9IHRoaXMuZ2V0Q29udGV4dEZvclR5cGUoc2NvcGUsICd2cGNTdWJuZXRJZHMnLCAnb2JqZWN0JywgZGVmYXVsdHMpO1xuICAgICAgICBjb25zdCB2cGNTZWN1cml0eUdyb3VwSWRzID0gdGhpcy5nZXRDb250ZXh0Rm9yVHlwZShzY29wZSwgJ3ZwY1NlY3VyaXR5R3JvdXBJZHMnLCAnb2JqZWN0JywgZGVmYXVsdHMpO1xuICAgICAgICBjb25zdCBhdmFpbGFiaWxpdHlab25lQ291bnQgPSB0aGlzLmdldENvbnRleHRGb3JUeXBlKHNjb3BlLCAnYXZhaWxhYmlsaXR5Wm9uZUNvdW50JywgJ251bWJlcicsIGRlZmF1bHRzKTtcbiAgICAgICAgY29uc3QgZWtzTG9nR3JvdXBOYW1lID0gdGhpcy5nZXRDb250ZXh0Rm9yVHlwZShzY29wZSwgJ2Vrc0xvZ0dyb3VwTmFtZScsICdzdHJpbmcnLCBkZWZhdWx0cyk7XG4gICAgICAgIGNvbnN0IHBvZExvZ0dyb3VwTmFtZSA9IHRoaXMuZ2V0Q29udGV4dEZvclR5cGUoc2NvcGUsICdwb2RMb2dHcm91cE5hbWUnLCAnc3RyaW5nJywgZGVmYXVsdHMpO1xuICAgICAgICBjb25zdCBhcHBUeXBlQ29uZmlncyA9IHRoaXMuZ2V0Q29udGV4dEZvclR5cGUoc2NvcGUsICdhcHBUeXBlQ29uZmlncycsICdvYmplY3QnLCBkZWZhdWx0cyk7XG5cbiAgICAgICAgdmFsaWRhdG9yLnZhbGlkYXRlUmVxdWlyZWQoZG9tYWluTmFtZSwgJ2RvbWFpbk5hbWUnKTtcbiAgICAgICAgdmFsaWRhdG9yLnZhbGlkYXRlRW5naW5lVmVyc2lvbihlbmdpbmVWZXJzaW9uKTtcbiAgICAgICAgdmFsaWRhdG9yLnZhbGlkYXRlRWJzVm9sdW1lVHlwZShlYnNWb2x1bWVUeXBlKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgb3BlblNlYXJjaDoge1xuICAgICAgICAgICAgICAgIGRvbWFpbk5hbWU6IGRvbWFpbk5hbWUhLFxuICAgICAgICAgICAgICAgIGVuZ2luZVZlcnNpb246IGVuZ2luZVZlcnNpb24hLFxuICAgICAgICAgICAgICAgIGRhdGFOb2RlVHlwZTogZGF0YU5vZGVUeXBlIHx8ICd0My5zbWFsbC5zZWFyY2gnLFxuICAgICAgICAgICAgICAgIGRhdGFOb2RlQ291bnQ6IGRhdGFOb2RlQ291bnQgfHwgMSxcbiAgICAgICAgICAgICAgICBkZWRpY2F0ZWRNYW5hZ2VyTm9kZVR5cGUsXG4gICAgICAgICAgICAgICAgZGVkaWNhdGVkTWFuYWdlck5vZGVDb3VudCxcbiAgICAgICAgICAgICAgICB3YXJtTm9kZVR5cGUsXG4gICAgICAgICAgICAgICAgd2FybU5vZGVDb3VudCxcbiAgICAgICAgICAgICAgICBlYnNFbmFibGVkOiBlYnNFbmFibGVkICE9PSB1bmRlZmluZWQgPyBlYnNFbmFibGVkIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlYnNJb3BzLFxuICAgICAgICAgICAgICAgIGVic1ZvbHVtZVNpemU6IGVic1ZvbHVtZVNpemUgfHwgMTAsXG4gICAgICAgICAgICAgICAgZWJzVm9sdW1lVHlwZSxcbiAgICAgICAgICAgICAgICBhdmFpbGFiaWxpdHlab25lQ291bnQ6IGF2YWlsYWJpbGl0eVpvbmVDb3VudCB8fCAxLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG5ldHdvcms6IHtcbiAgICAgICAgICAgICAgICB2cGNFbmFibGVkOiB2cGNFbmFibGVkIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIHZwY0lkLFxuICAgICAgICAgICAgICAgIHZwY1N1Ym5ldElkcyxcbiAgICAgICAgICAgICAgICB2cGNTZWN1cml0eUdyb3VwSWRzLFxuICAgICAgICAgICAgICAgIGF2YWlsYWJpbGl0eVpvbmVDb3VudDogYXZhaWxhYmlsaXR5Wm9uZUNvdW50IHx8IDEsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9nczoge1xuICAgICAgICAgICAgICAgIGVrc0xvZ0dyb3VwTmFtZSxcbiAgICAgICAgICAgICAgICBwb2RMb2dHcm91cE5hbWUsXG4gICAgICAgICAgICAgICAgYXBwVHlwZUNvbmZpZ3M6IGFwcFR5cGVDb25maWdzIHx8IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YWdlLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGdldENvbnRleHRGb3JUeXBlKFxuICAgICAgICBzY29wZTogQ29uc3RydWN0LCBcbiAgICAgICAgb3B0aW9uTmFtZTogc3RyaW5nLCBcbiAgICAgICAgZXhwZWN0ZWRUeXBlOiBzdHJpbmcsIFxuICAgICAgICBkZWZhdWx0VmFsdWVzOiBSYXdDb25maWdEZWZhdWx0c1xuICAgICk6IGFueSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbiA9IHNjb3BlLm5vZGUudHJ5R2V0Q29udGV4dChvcHRpb25OYW1lKTtcblxuICAgICAgICAvLyBJZiBubyBjb250ZXh0IGlzIHByb3ZpZGVkICh1bmRlZmluZWQgb3IgZW1wdHkgc3RyaW5nKSBhbmQgYSBkZWZhdWx0IHZhbHVlIGV4aXN0cywgdXNlIGl0XG4gICAgICAgIGlmICgob3B0aW9uID09PSB1bmRlZmluZWQgfHwgb3B0aW9uID09PSBcIlwiKSAmJiBkZWZhdWx0VmFsdWVzW29wdGlvbk5hbWUgYXMga2V5b2YgUmF3Q29uZmlnRGVmYXVsdHNdKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlc1tvcHRpb25OYW1lIGFzIGtleW9mIFJhd0NvbmZpZ0RlZmF1bHRzXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbHRlciBvdXQgaW52YWxpZCBvciBtaXNzaW5nIG9wdGlvbnMgYnkgc2V0dGluZyB1bmRlZmluZWQgKGVtcHR5IHN0cmluZ3MsIG51bGwsIHVuZGVmaW5lZCwgTmFOKVxuICAgICAgICBpZiAob3B0aW9uICE9PSBmYWxzZSAmJiBvcHRpb24gIT09IDAgJiYgIW9wdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbHVlcyBwcm92aWRlZCBieSB0aGUgQ0xJIHdpbGwgYWx3YXlzIGJlIHJlcHJlc2VudGVkIGFzIGEgc3RyaW5nIGFuZCBuZWVkIHRvIGJlIHBhcnNlZFxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGlmIChleHBlY3RlZFR5cGUgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gcGFyc2VJbnQob3B0aW9uKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4ocGFyc2VkKSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbnVtYmVyIGZvcm1hdCBmb3IgJHtvcHRpb25OYW1lfTogJHtvcHRpb259YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZXhwZWN0ZWRUeXBlID09PSAnYm9vbGVhbicgfHwgZXhwZWN0ZWRUeXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKG9wdGlvbik7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIEpTT04gZm9ybWF0IGZvciAke29wdGlvbk5hbWV9OiAke29wdGlvbn1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWx1ZXMgcHJvdmlkZWQgYnkgdGhlIGNkay5jb250ZXh0Lmpzb24gc2hvdWxkIGJlIG9mIHRoZSBkZXNpcmVkIHR5cGVcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb24gIT09IGV4cGVjdGVkVHlwZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUeXBlIHByb3ZpZGVkIGJ5IGNkay5jb250ZXh0Lmpzb24gZm9yICR7b3B0aW9uTmFtZX0gd2FzICR7dHlwZW9mIG9wdGlvbn0gYnV0IGV4cGVjdGVkICR7ZXhwZWN0ZWRUeXBlfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG9wdGlvbjtcbiAgICB9XG59Il19